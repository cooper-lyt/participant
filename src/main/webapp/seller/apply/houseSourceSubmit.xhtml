<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:composition template="/seller/layout/pageTemplate.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:ui="http://java.sun.com/jsf/facelets">

    <div class="page-form">
    <b:row>
    <b:column offsetLg="2" offsetMd="2" offsetSm="1" offsetXs="0" colLg="8" colMd="8" colSm="10" colXs="12">


        <div class="setup-header setup-gift">
            <h1 class="subhead-heading">房源提交审核</h1>

            <ol class="steps steps-4">
                <li class="complete">
                    <b:iconAwesome name="check" size="2x"/>
                    <strong class="step">产权:</strong>
                    产权验证
                </li>
                <li class="complete">
                    <b:iconAwesome name="check" size="2x"/>
                    <strong class="step">描述:</strong>
                    房屋描述
                </li>
                <li class="complete">
                    <b:iconAwesome name="check" size="2x"/>
                    <strong class="step">图片:</strong>
                    图片上传
                </li>
                <li class="current">
                    <b:iconAwesome name="university" size="2x"/>
                    <strong class="step">提交:</strong>
                    房源提交
                </li>
            </ol>
        </div>
        <b:messages globalOnly="false" styleClass="top-messages"/>
    </b:column>

    </b:row>

        <b:row>
            <b:column offsetLg="2" offsetMd="2" offsetSm="1" offsetXs="0" colLg="8" colMd="8" colSm="10" colXs="12">
                <h:form>
                <b:panel >
                    <h:outputText value="房源将提交管理部门审核，在审核完成前房源信息将不可修改！"/>
                    <b:commandButton style="float:right;" look="success" action="#{houseSaleInfoEdit.commitHouseSource}" value="提交">
                        <f:param name="houseSaleInfoId" value="#{houseSourceHome.instance.id}"/>
                    </b:commandButton>
                </b:panel>
                </h:form>
            </b:column>
        </b:row>

        <b:row>
            <b:column offsetLg="2" offsetMd="2" offsetSm="1" offsetXs="0" colLg="8" colMd="8" colSm="10" colXs="12">

                <h:form>
                    <p:remoteCommand name="updateMapLocation" update="@none" actionListener="#{houseSaleInfoEdit.updateLocation}"/>
                </h:form>

                <div style="width: 100%;height: 500px;" id="local-map"></div>

                <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&amp;ak=hbl1cUkMyAG2kzFGmZWdztMt"></script>
                <h:outputScript>
                    // 百度地图API功能

                    var map = new BMap.Map("local-map");    // 创建Map实例

                    var point = new BMap.Point(#{runParam.getStringParam('map.lng')},#{runParam.getStringParam('map.lat')});

                    var geolocation = new BMap.Geolocation();
                    geolocation.getCurrentPosition(function(r){
                        if(this.getStatus() == BMAP_STATUS_SUCCESS){
                            point = r.point;
                        }
                    },{enableHighAccuracy: true})
                    map.centerAndZoom(point, #{runParam.getStringParam('map.zoom')});  // 初始化地图,设置中心点坐标和地图级别

                    // 添加带有定位的导航控件
                    var navigationControl = new BMap.NavigationControl({
                        // 靠左上角位置
                        anchor: BMAP_ANCHOR_TOP_LEFT,
                        // LARGE类型
                        type: BMAP_NAVIGATION_CONTROL_LARGE,
                        // 启用显示定位
                        enableGeolocation: true
                    });
                    map.addControl(navigationControl);

                    map.addControl(new BMap.MapTypeControl());   //添加地图类型控件



                    var maker_point = new BMap.Point(#{houseSourceHome.lng},#{houseSourceHome.lat});
                    var marker = new BMap.Marker(maker_point);// 创建标注
                    marker.addEventListener("dragend",function(e){updateMapLocation([{name:'houseSaleInfoId',value: '#{houseSourceHome.instance.id}'},{name:'lat',value: e.point.lat},{name:'lng',value: e.point.lng}]) });

                    map.addOverlay(marker);             // 将标注添加到地图中

                    marker.enableDragging(); // 不可拖拽

                </h:outputScript>

            </b:column>
        </b:row>

    </div>


</ui:composition>